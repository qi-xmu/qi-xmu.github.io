---
import Search from "@/components/Search.astro";
import ThemeToggle from "@/components/ThemeToggle.astro";
import { menuLinks } from "@/site.config";
---

<header class="group relative mb-28 flex items-center sm:ps-18" id="main-header">
	<div class="flex sm:flex-col">
		<a
			aria-current={Astro.url.pathname === "/" ? "page" : false}
			class="inline-flex items-center grayscale hover:filter-none sm:relative sm:inline-block"
			href="/"
		>
			<svg
				aria-hidden="true"
				class="me-3 h-10 w-10 sm:absolute sm:-start-18 sm:me-0 sm:h-8 sm:w-8"
				fill="none"
				focusable="false"
				viewBox="0 0 255 255"
				xmlns="http://www.w3.org/2000/svg"
			>
				<g>
					<rect height="254.446" opacity="0" width="254.392" x="0" y="0"></rect>
					<path
						d="M26.5013 182.049L40.1975 155.712C43.9572 148.559 47.8223 144.382 51.909 144.382C56.0455 144.382 60.4036 148.403 66.581 156.566C78.2722 171.529 86.0325 178.963 93.6218 178.963C100.995 178.963 109.987 168.091 109.987 160.653C109.987 155.074 101.864 150.379 101.864 147.424C101.864 145.961 103.382 145.041 105.986 145.041C125.514 145.041 140.064 128.956 140.064 117.477C140.064 106.736 127.8 98.2271 127.8 94.1908C127.8 93.1101 128.554 92.4064 129.418 92.4064C130.549 92.4064 132.218 93.6878 135.571 96.0052C149.041 106.182 155.897 101.278 156.952 93.6777C157.319 90.6064 159.053 87.7666 166.306 84.2835C179.218 77.9257 192.337 66.0183 192.337 56.5494C192.337 44.1952 174.785 38.782 174.785 35.3787C174.785 33.2777 179.535 30.9954 188.271 28.4517L185.557 17.3852C171.805 21.1499 162.341 27.3623 162.341 34.7457C162.341 45.105 180.999 50.0952 180.999 56.5494C180.999 62.1183 170.328 69.5126 161.939 73.7999C149.062 80.6702 148.935 84.4903 147.563 89.0899C145.086 95.1116 138.351 82.8623 127.836 82.8623C121.739 82.8623 117.306 86.8732 117.306 92.9246C117.306 102.288 128.726 110.943 128.726 117.477C128.726 125.398 119.855 134.653 103.031 134.653C94.4063 134.653 89.5257 138.618 89.5257 145.369C89.5257 151.681 98.2265 157.833 98.2265 160.653C98.2265 163.126 95.4463 166.675 93.8327 166.675C91.0884 166.675 85.2376 161.729 75.6826 149.49C67.4798 138.819 60.0359 133.044 52.542 133.044C42.4551 133.044 35.9814 141.085 31.6738 148.957L19.2286 172.093ZM183.165 234.126L192.267 227.205C186.637 219.646 179.566 209.393 165.126 209.393C156.189 209.393 154.194 212.399 147.413 212.399C143.145 212.399 140.823 208.785 139.104 201.305C137.54 194.675 136.902 190.161 140.878 188.326C145.713 186.326 161.059 184.843 166.311 168.704C170.076 157.143 173.791 152.624 180.365 152.624C192.455 152.624 190.057 164.27 202.798 164.27C208.311 164.27 211.317 161.802 215.731 161.802C221.596 161.802 225.859 167.221 227.106 181.365L238.383 176.219C236.122 159.712 228.256 150.465 217.45 150.465C214.555 150.465 210.915 151.002 207.427 152.128C202.954 153.581 201.968 153.199 198.47 149.162C193.273 143.427 188.99 141.286 181.868 141.286C169.046 141.286 161.191 147.232 155.295 165.352C153.626 170.68 151.309 172.459 142.115 175.898L136.802 177.883C127.007 181.577 124.388 188.589 127.871 203.913C131.033 217.203 137.295 223.842 146.287 223.842C154.429 223.842 159.426 220.837 165.126 220.837C173.399 220.676 177.435 225.989 183.165 234.126ZM156.284 119.362C164.376 119.362 168.02 112.074 177.238 109.395C183.295 107.626 186.456 101.408 186.456 96.2113C186.456 91.9238 184.365 88.2799 179.756 88.2799C174.881 88.2799 170.272 92.0847 167.271 98.4078C165.663 102.052 162.984 103.821 156.284 105.696C151.031 107.304 149.157 109.234 149.157 113.2C149.157 117.487 152.479 119.362 156.284 119.362ZM119.949 177.188C127.076 177.188 134.098 168.935 134.098 161.487C134.098 152.429 130.293 148.142 126.006 148.142C121.236 148.142 118.235 153.716 118.235 162.291C118.235 167.166 113.948 167.327 113.948 172.258C113.948 175.259 116.305 177.188 119.949 177.188ZM98.1355 200.123C103.549 200.123 107.032 197.339 107.032 192.73C107.032 189.246 104.353 187.05 100.548 187.05C85.4895 187.05 84.8461 178.475 77.5581 178.475C73.5371 178.475 70.6973 180.833 70.6973 184.316C70.6973 187.156 73.5371 189.246 77.2365 189.246C85.3286 189.246 81.5238 200.123 98.1355 200.123ZM127.143 254.285C197.384 254.285 254.391 197.384 254.391 127.143C254.391 56.9016 197.384 0 127.143 0C57.0071 0 3.55271e-15 56.9016 3.55271e-15 127.143C3.55271e-15 197.384 57.0071 254.285 127.143 254.285ZM127.143 239.52C65.1335 239.52 14.8705 189.152 14.8705 127.143C14.8705 65.1333 65.1335 14.7651 127.143 14.7651C189.152 14.7651 239.52 65.1333 239.52 127.143C239.52 189.152 189.152 239.52 127.143 239.52Z"
						fill="#888"></path>
				</g>
			</svg>
			<span class="text-xl font-bold sm:text-2xl">Qi's Blog</span>
		</a>
		<nav
			aria-label="Main menu"
			class="bg-global-bg/85 text-accent sm:divide-accent absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md py-4 shadow backdrop-blur-sm group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
			id="navigation-menu"
		>
			{
				menuLinks.map((link) => (
					<a
						aria-current={Astro.url.pathname === link.path ? "page" : false}
						class="px-4 py-4 underline-offset-2 hover:underline sm:py-0"
						data-astro-prefetch
						href={link.path}
					>
						{link.title}
					</a>
				))
			}
		</nav>
	</div>
	<Search />
	<ThemeToggle />
	<mobile-button>
		<button
			aria-expanded="false"
			aria-haspopup="menu"
			class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden"
			id="toggle-navigation-menu"
			type="button"
		>
			<span class="sr-only">Open main menu</span>
			<svg
				aria-hidden="true"
				class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
				fill="none"
				focusable="false"
				id="line-svg"
				stroke="currentColor"
				stroke-width="1.5"
				viewBox="0 0 24 24"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"
				></path>
			</svg>
			<svg
				aria-hidden="true"
				class="text-accent absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
				class="text-accent"
				fill="none"
				focusable="false"
				id="cross-svg"
				stroke="currentColor"
				stroke-width="1.5"
				viewBox="0 0 24 24"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
			</svg>
		</button>
	</mobile-button>
</header>

<script>
	import { toggleClass } from "@/utils/domElement";

	class MobileNavBtn extends HTMLElement {
		#menuOpen: boolean = false;

		connectedCallback() {
			const headerEl = document.getElementById("main-header")!;
			const mobileButtonEl = this.querySelector<HTMLButtonElement>("button");

			mobileButtonEl?.addEventListener("click", () => {
				if (headerEl) toggleClass(headerEl, "menu-open");
				this.#menuOpen = !this.#menuOpen;
				mobileButtonEl.setAttribute("aria-expanded", this.#menuOpen.toString());
			});
		}
	}

	customElements.define("mobile-button", MobileNavBtn);
</script>
